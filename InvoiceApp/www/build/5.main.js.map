{"version":3,"sources":["../../src/pages/work/transfer-detail/transfer-detail.module.ts","../../src/pages/work/transfer-detail/transfer-detail.ts"],"names":[],"mappings":"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","file":"5.main.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { TransferDetailPage} from './transfer-detail';\r\n\r\n@NgModule({\r\n    declarations: [\r\n        TransferDetailPage\r\n    ],\r\n    imports: [\r\n        IonicPageModule.forChild(TransferDetailPage)      \r\n    ],\r\n    exports: [\r\n        TransferDetailPage\r\n    ]\r\n})\r\nexport class TransferDetailPageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/work/transfer-detail/transfer-detail.module.ts","import { Component } from '@angular/core';\r\nimport { IonicPage,NavController, NavParams, ViewController, ModalController, PopoverController } from 'ionic-angular';\r\nimport { SqlService } from '../../../providers/sql-service';\r\nimport { UtilService } from '../../../providers/util-service';\r\nimport { StkService } from '../../../providers/stk-service';\r\n\r\n/*\r\n  调拨单明细页面\r\n  wudefeng\r\n  2017-5-11 \r\n*/\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-transfer-detail',\r\n  templateUrl: 'transfer-detail.html'\r\n})\r\nexport class TransferDetailPage {\r\n\r\n  title: string = \"新增调拨单\";\r\n  item: any = {};\r\n  goodsList: any[] = []; \r\n  billStatus: string = '10';\r\n  isAdd: boolean = true;\r\n  storeList: any[] = [];\r\n  parentPage: any;\r\n\r\n  constructor(\r\n    public navCtrl: NavController,\r\n    public navParams: NavParams,\r\n    public viewCtrl: ViewController,\r\n    public sqlHelp: SqlService,\r\n    public util: UtilService,\r\n    public modalCtrl: ModalController,\r\n    public stkService: StkService,\r\n    public popoverCtrl: PopoverController\r\n  ) { }\r\n\r\n  ionViewDidLoad() {\r\n\r\n    let obj = this.navParams.get('item');\r\n    this.parentPage = this.navParams.get('parentPage');\r\n    if (obj) {\r\n      this.item = obj;\r\n      this.sqlHelp.getRowsBySql('select a.*,b.cost_price from bl_transfer_dtl a join good b on a.good_no=b.good_no  where bill_no=?', [obj.bill_no]).then(data => {\r\n        this.goodsList = [].concat(data);       \r\n      });\r\n      this.billStatus = obj.bill_status;\r\n      this.isAdd = false;\r\n      this.title = \"调拨单明细\";\r\n    } else {\r\n      this.item = {\r\n        bill_status: '10',\r\n        creator: this.util.loginUser,\r\n        create_time: this.util.getNowFormatDate()\r\n      }\r\n      this.sqlHelp.getCodeNo(\"TO\").then(no => {\r\n        this.item.bill_no = no;\r\n      });\r\n    }  \r\n  }\r\n\r\n  exit(isChange: any = false) {\r\n    this.parentPage && this.parentPage.getData && this.parentPage.getData(true);\r\n    this.navCtrl.pop();\r\n  }\r\n\r\n  save() {\r\n    let errmsg = \"\";\r\n    if (this.item.out_store_no == this.item.in_store_no) {\r\n      errmsg = \"不能相同仓库进行调拨\"\r\n    }\r\n\r\n    if (this.goodsList.length == 0) {\r\n      errmsg = \"还没有选择物料，不能保存\";\r\n    }\r\n    if (errmsg.length > 0) {\r\n      this.util.showAlert(errmsg, \"错误\");\r\n      return;\r\n    }\r\n    let obj = {\r\n      bill_no: this.item.bill_no,\r\n      bill_status: this.item.bill_status,\r\n      out_store_no: this.item.out_store_no,\r\n      in_store_no: this.item.in_store_no,\r\n      creator: this.util.loginUser,\r\n      create_time: this.util.getNowFormatDate()\r\n    }\r\n    let dtllist = this.goodsList.map(item => { delete item.cost_price;return item; });\r\n    this.sqlHelp.saveBill(\"bl_transfer\", obj, \"bl_transfer_dtl\", dtllist).then(data => {\r\n      console.info(\"单据保存成功\");\r\n      this.exit(true);\r\n    }).catch(err => {\r\n      console.error(\"保存失败\", err);\r\n    });\r\n  }\r\n\r\n  chooseStore(storetype: string) {\r\n\r\n    if (this.goodsList.length > 0 || this.billStatus == \"20\") return;  \r\n\r\n    let storepage = this.modalCtrl.create('DepotListPage', { isChoose: true });\r\n  \r\n    storepage.onDidDismiss(store => {\r\n      if (store) {\r\n        if (storetype == \"O\") {\r\n          this.item.out_store_no = store.store_no;\r\n          this.item.out_store_name = store.store_name;\r\n        } else {\r\n          this.item.in_store_no = store.store_no;\r\n          this.item.in_store_name = store.store_name;\r\n        }\r\n      }\r\n    });\r\n    storepage.present();\r\n  }\r\n\r\n  changeQty(obj: any, qty: number) {\r\n    if (qty == -1 && obj.qty == 1) return;\r\n    obj.qty += qty;\r\n  }\r\n\r\n  inputQty(obj: any) {\r\n    if (this.billStatus != \"10\") return;\r\n    this.util.showPrompt('', '输入数量', [{ name: 'qty', placeholder: '请输入调拨数量', type: 'number', value: obj.qty }], data => {\r\n\r\n      if (data.qty == \"\") {\r\n        this.util.showAlert(\"请输入数量\");\r\n        return false;\r\n      }\r\n      if (Number(data.qty) > 0) {\r\n        obj.qty = data.qty;\r\n      }\r\n    });\r\n  }\r\n\r\n  chooseGoods() {\r\n\r\n    if (!this.item.in_store_no || !this.item.out_store_no) {\r\n      this.util.showAlert(\"请先选择调出仓及调入仓\");\r\n      return;\r\n    }\r\n     this.navCtrl.push('TransferGoodsPage', { parentPage:this });\r\n    \r\n  }  \r\n\r\n  deleteItem(item: any) {\r\n    this.goodsList.splice(this.goodsList.indexOf(item), 1);\r\n  }\r\n\r\n  showMore(ev) {\r\n\r\n    let popover = this.popoverCtrl.create('TransferToolPage', {\r\n      parentPage: this\r\n    }, { cssClass:\"mypopover\"});\r\n\r\n    popover.present({\r\n      ev: ev\r\n    });\r\n  }\r\n  \r\n  getTotalCost() {\r\n    let cost = 0;\r\n    for (let item of this.goodsList) {\r\n      cost += item.cost_price * item.qty;\r\n    }\r\n    return cost;\r\n  }\r\n\r\n  getTotalCount() {\r\n    return this.goodsList.length;\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/work/transfer-detail/transfer-detail.ts"],"sourceRoot":""}